package MonotonicStack;

import java.util.LinkedList;

/**
 * <a href="https://leetcode.cn/problems/largest-rectangle-in-histogram/description/">84.柱状图中最大的矩形</a>
 * 给定 n 个非负整数，用来表示柱状图中各个柱子的高度。每个柱子彼此相邻，且宽度为 1。
 * <p>
 * 求在该柱状图中，能够勾勒出来的矩形的最大面积。
 * <p>
 * 解题思路：
 * 使用单调栈来解决柱状图中最大矩形问题。
 * <p>
 * 核心思想：对于每个柱子，以它的高度为高的最大矩形，其宽度是向左右两边扩展到第一个比它矮的柱子为止。
 * <p>
 * 算法步骤：
 * 1. 维护一个单调递增栈（栈中存储的是柱子的索引），确保栈中柱子的高度是递增的
 * 2. 遍历柱子数组，包括一个虚拟的末尾柱子（高度为0），确保所有柱子都能被处理
 * 3. 当遇到比栈顶柱子矮的柱子时，说明找到了栈顶柱子右边界，可以计算以栈顶柱子高度为高的矩形面积
 * 4. 弹出栈顶元素作为当前计算高度的柱子
 * 5. 确定矩形的左边界：栈中下一个元素（若栈为空则为-1）
 * 6. 确定矩形的右边界：当前遍历到的柱子
 * 7. 计算宽度：右边界索引 - 左边界索引 - 1
 * 8. 计算面积并更新最大面积
 * 9. 将当前柱子索引入栈
 * <p>
 * 状态定义：
 * - stack: 单调递增栈，存储柱子的索引
 * - h: 以弹出柱子高度为高的矩形的高度
 * - left: 矩形的左边界（左边第一个比当前柱子矮的柱子索引）
 * - w: 矩形的宽度
 * - res: 记录的最大矩形面积
 * <p>
 * 时间复杂度: O(n)，每个元素最多入栈出栈一次
 * 空间复杂度: O(n)，栈的最大空间
 *
 * @author lxd
 **/
public class Day20260108 {
    /**
     * 计算柱状图中最大矩形的面积
     *
     * @param heights 表示柱状图中各个柱子高度的数组
     * @return 柱状图中最大矩形的面积
     */
    public int largestRectangleArea(int[] heights) {
        // 获取柱状图数组长度
        int n = heights.length;
        // 记录最大矩形面积，初始化为0
        int res = 0;
        // 创建单调递增栈，存储柱子的索引
        LinkedList<Integer> stack = new LinkedList<>();

        // 遍历所有柱子，包括一个虚拟的末尾柱子（高度为0）
        // 虚拟柱子的作用是确保栈中所有剩余元素都会被处理
        for (int i = 0; i <= n; i++) {
            // 当前柱子的高度，如果i等于n则为0（虚拟柱子）
            int currHeight = (i == n ? 0 : heights[i]);

            // 当栈不为空且当前柱子高度小于栈顶柱子高度时
            // 说明找到了栈顶柱子的右边界，可以计算以栈顶柱子高度为高的矩形面积
            while (!stack.isEmpty() && currHeight < heights[stack.peek()]) {
                // 弹出栈顶元素，作为计算矩形面积的高度
                int h = heights[stack.pop()];

                // 确定矩形的左边界：
                // 如果栈为空，说明左边没有比当前柱子矮的柱子，左边界为-1
                // 如果栈不为空，左边界为栈顶元素（即左边第一个比当前柱子矮的柱子）
                int left = stack.isEmpty() ? -1 : stack.peek();

                // 计算矩形的宽度：
                // 当前柱子索引i是右边界，left是左边界
                // 宽度 = 右边界 - 左边界 - 1
                int w = i - left - 1;

                // 更新最大面积：取当前面积和之前记录的最大面积的较大值
                res = Math.max(res, h * w);
            }

            // 将当前柱子索引入栈
            stack.push(i);
        }

        // 返回计算得到的最大矩形面积
        return res;
    }
}
